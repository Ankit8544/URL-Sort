<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - URL Shortener</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <a href="/" class="logo">
                    <span class="logo-icon">üîó</span>
                    <span class="logo-text">ShortLink</span>
                </a>
                <div class="nav-links">
                    <a href="/" class="nav-link">Home</a>
                    <a href="/dashboard" class="nav-link active">Dashboard</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard Header -->
    <section class="dashboard-header">
        <div class="container">
            <h1 class="dashboard-title">üìä Analytics Dashboard</h1>
            <p class="dashboard-subtitle">Track and manage all your shortened URLs</p>
        </div>
    </section>

    <!-- Stats Cards -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üîó</div>
                    <div class="stat-content">
                        <h3 class="stat-value">{{ total_urls }}</h3>
                        <p class="stat-label">Total Links</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üëÜ</div>
                    <div class="stat-content">
                        <h3 class="stat-value">{{ total_clicks }}</h3>
                        <p class="stat-label">Total Clicks</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-content">
                        <h3 class="stat-value">{{ "%.1f"|format(total_clicks / total_urls if total_urls > 0 else 0) }}</h3>
                        <p class="stat-label">Avg. Clicks/Link</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- URLs Table -->
    <section class="table-section">
        <div class="container">
            <div class="table-card">
                <div class="table-header">
                    <h2>Your Shortened URLs</h2>
                    <a href="/" class="btn-primary-small">+ Create New</a>
                </div>

                {% if urls %}
                <div class="table-wrapper">
                    <table class="urls-table">
                        <thead>
                            <tr>
                                <th>Short Code</th>
                                <th>Original URL</th>
                                <th>Clicks</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for url in urls %}
                            <tr data-short-code="{{ url[0] }}">
                                <td>
                                    <div class="short-code-cell">
                                        <code class="short-code">{{ url[0] }}</code>
                                        <button onclick="copyShortUrl('{{ url[0] }}')" class="btn-icon" title="Copy">
                                            üìã
                                        </button>
                                    </div>
                                </td>
                                <td>
                                    <div class="original-url">
                                        <a href="{{ url[1] }}" target="_blank" class="url-link">
                                            {{ url[1][:50] }}{% if url[1]|length > 50 %}...{% endif %}
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge badge-clicks">{{ url[2] }} clicks</span>
                                </td>
                                <td>
                                    <span class="date-text">{{ url[3][:10] }}</span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="/analytics/{{ url[0] }}" class="btn-icon" title="View Analytics">
                                            üìä
                                        </a>
                                        <a href="/{{ url[0] }}" target="_blank" class="btn-icon" title="Visit">
                                            üîó
                                        </a>
                                        <button onclick="deleteUrl('{{ url[0] }}')" class="btn-icon btn-danger" title="Delete">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üì≠</div>
                    <h3>No URLs Yet</h3>
                    <p>Create your first shortened URL to get started!</p>
                    <a href="/" class="btn-primary">Create URL</a>
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 ShortLink. Made with ‚ù§Ô∏è using Flask</p>
        </div>
    </footer>

    <script>
        function copyShortUrl(shortCode) {
            const url = window.location.origin + '/' + shortCode;
            navigator.clipboard.writeText(url).then(() => {
                showNotification('Copied to clipboard! üìã', 'success');
            });
        }

        function deleteUrl(shortCode) {
            if (!confirm('Are you sure you want to delete this URL? All analytics data will also be deleted.')) {
                return;
            }

            fetch(`/api/delete/${shortCode}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const row = document.querySelector(`tr[data-short-code="${shortCode}"]`);
                    row.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        row.remove();
                        showNotification('URL deleted successfully! üóëÔ∏è', 'success');
                        
                        // Reload if no more URLs
                        if (document.querySelectorAll('.urls-table tbody tr').length === 0) {
                            location.reload();
                        }
                    }, 300);
                } else {
                    showNotification('Failed to delete URL', 'error');
                }
            })
            .catch(error => {
                showNotification('An error occurred', 'error');
            });
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: ${type === 'success' ? '#10b981' : '#ef4444'};
                color: white;
                border-radius: 12px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>